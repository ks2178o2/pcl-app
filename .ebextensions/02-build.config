files:
  "/opt/elasticbeanstalk/hooks/appdeploy/pre/01_build_frontend.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      # Build frontend with environment variables set
      # This ensures VITE_API_URL is available during build
      
      cd /var/app/ondeck/apps/realtime-gateway || exit 1
      
      # Export environment variables for build
      export VITE_API_URL="${VITE_API_URL}"
      export VITE_SUPABASE_URL="${VITE_SUPABASE_URL}"
      export VITE_SUPABASE_ANON_KEY="${VITE_SUPABASE_ANON_KEY}"
      
      # Verify variables are set
      echo "Building frontend with:"
      echo "VITE_API_URL=${VITE_API_URL}"
      echo "VITE_SUPABASE_URL=${VITE_SUPABASE_URL}"
      
      # Build the frontend
      npm install
      npm run build
      
      echo "Frontend build complete"


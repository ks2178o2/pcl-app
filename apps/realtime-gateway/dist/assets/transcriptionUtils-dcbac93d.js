import{s as g}from"./index-4d935a33.js";async function b(a){let o="deepgram",i="assemblyai",t=!0,c=!1;if(a.organizationId)try{const{data:e,error:f}=await g.from("organizations").select("transcription_provider, transcription_fallback_provider, transcription_allow_fallback, transcription_bakeoff").eq("id",a.organizationId).maybeSingle();if(!f&&e){const l=e;o=l.transcription_provider||"deepgram",i=l.transcription_fallback_provider||"assemblyai",t=l.transcription_allow_fallback??!0,c=l.transcription_bakeoff??!1,console.log("üìä Using organization transcription settings:",{provider:o,fallback:i,allowFallback:t,bakeoff:c})}}catch(e){console.warn("‚ö†Ô∏è Could not fetch organization transcription settings, using defaults:",e)}const s=localStorage.getItem("transcriptionProvider"),n=a.overrideProvider||o||s||"deepgram",d=a.overrideFallback||i||(n==="deepgram"?"assemblyai":"deepgram"),r={callId:a.callId,audioBase64:a.audioBase64,audioUrl:a.audioUrl,storagePath:a.storagePath,provider:n,fallback_provider:d,allow_fallback:a.overrideAllowFallback??t,bakeoff:a.overrideBakeoff??c,useChunks:a.useChunks,salespersonName:a.salespersonName,customerName:a.customerName,clientTraceId:`${Date.now().toString(36)}-${Math.random().toString(36).slice(2,8)}`};return a.language&&(r.language=a.language),console.log("üé§ Built transcription payload:",{callId:r.callId,provider:r.provider,fallback:r.fallback_provider,allowFallback:r.allow_fallback,bakeoff:r.bakeoff,hasAudio:!!(r.audioBase64||r.audioUrl||r.storagePath),useChunks:r.useChunks}),r}export{b as buildTranscriptionPayload};
